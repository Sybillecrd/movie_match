<% content_for(:body_class, "flex-column") %>


<div class="backdrop">
  <div class="backdrop-img" style="background-image: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('<%= "https://image.tmdb.org/t/p/w500/#{@movie['backdrop_path']}" %>')"></div>
  <div class="container-fluid backdrop-content">
    <div class="row">
      <div class="poster col-xs-6">
        <%= tmdb_image_tag("#{@movie['poster_path']}", style: "width: 100%;") %>
      </div>
      <div class="infos col-xs-6">
        <h2><%= @movie['original_title'] %></h2>
        <p><%= @movie['release_date'] %></p>
        <%= @movie['genres'].map { |genre| genre["name"] }.join(', ') %>

          <% movie_mailer = Movie.find_by(tmdb_id: @movie["id"]) %>
          <% opinion_mailer = Opinion.find_by(movie_id: movie_mailer[:id]) %>
          <% if !movie_mailer.released? && !opinion_mailer[:release_mail] %>
            <%= link_to "Email me at release", movie_notifications_path(movie_mailer), method: :post, class: "btn btn-block btn-mailer" %>
          <% end %>

      </div>
    </div>
    <div class="synopsis">
      <p><%= @movie['overview'] %></p>
    </div>


  </div>
  <div class="mm-modal">
    <%= link_to "x", my_movie_path(@movie), class: "button-quit" %>
    <% key = @movie.dig('videos', 'results').try(:first).try(:dig, 'key') %>
    <%= render "trailers/youtube_iframe", class: "video", youtube_key: key %>
    <%= link_to "", my_movie_path(@movie), class: "mm-modal-quit" %>
  </div>
</div>

